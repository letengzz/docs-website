# RabbitMQ 消息模式

RabbitMQ 支持多种消息模型。

常见的消息模型：

1. **简单模式** (Simple Mode生产者消费者模式)：

   在简单模式中，一个生产者将消息发送到一个队列，然后一个消费者从该队列接收并处理消息。这是最基本的消息模型，适用于简单的应用场景。

2. **工作队列模式**（Work Queue Mode 广播模式）：
   工作队列模式也被称为任务队列模式。多个消费者共享一个队列，并通过轮询的方式接收消息。每个消息只会被一个消费者处理。适用于分布式任务的情况。

3. **发布/订阅模式**（Publish/Subscribe Mode）：
   在发布/订阅模式中，一个生产者将消息发送到交换机（Exchange），而不是直接发送到队列。然后，绑定到该交换机的多个队列都会收到消息。适用于广播类型的消息发送。

4. **路由模式**（Routing Mode）：
   路由模式中，消息根据路由键（Routing Key）的匹配规则被发送到特定的队列。生产者将消息发送到交换机，并指定一个路由键，在消费者端，队列通过绑定键（Binding Key）与交换机进行绑定。适用于根据条件筛选消息的情况。

5. **主题模式**（Topic Mode）：
   主题模式是路由模式的扩展，它支持使用通配符进行更灵活的匹配。通过使用特定的通配符匹配规则，可以实现灵活而强大的消息路由策略。适用于订阅特定主题的场景。

以上是 RabbitMQ 的五种常见消息模型，每种模型都有其适用的场景和特点。您可以根据具体需求选择合适的消息模型来构建应用程序。

**注意：** XX模式只是一种设计思路，并不是指的具体的某种实现。

## 简单模式

一个生产者 -> 消息队列 -> 一个消费者：生产者只需要将数据丢进消息队列，而消费者只需要将数据从消息队列中取出，这样就实现了生产者和消费者的消息交互。

![image-20220417103647609](https://cdn.jsdelivr.net/gh/letengzz/tc2/img202403122002551.jpg)

## 工作队列模式

工作队列模式非常适合多个工人等待新的任务到来的场景，任务有很多个，一个一个丢进消息队列，而此时工人有很多个，那么就可以将这些任务分配个各个工人，让他们各自负责一些任务，并且做的快的工人还可以做完成一些 (能者多劳)。

![image-20220420151258324](https://cdn.jsdelivr.net/gh/letengzz/tc2/img202403122258110.jpg)

## 发布订阅模式

比如我们在阿里云买了云服务器，但是最近快到期了，那么就会给你的手机、邮箱发送消息，告诉你需要去续费了，但是手机短信和邮件发送并不一定是同一个业务提供的，但是现在又希望能够都去执行，所以就可以用到发布订阅模式，简而言之就是，发布一次，消费多个。

实现这种模式其实也非常简单，但是如果使用直连交换机，肯定是不行的，这里需要用到另一种类型的交换机，叫做`fanout`（扇出）类型，这时一种广播类型，消息会被广播到所有与此交换机绑定的消息队列中。

![image-20220420172252440](https://cdn.jsdelivr.net/gh/letengzz/tc2/img202403122300359.jpg)

## 路由模式

路由模式在绑定时指定想要的`routingKey`只有生产者发送时指定了对应的`routingKey`才能到达对应的队列。

![image-20220420232826848](https://cdn.jsdelivr.net/gh/letengzz/tc2/img202403122301720.jpg)

## 主题模式

实际上这种模式就是一种模糊匹配的模式，可以将`routingKey`以模糊匹配的方式去进行转发。

可以使用`*`或`#`来表示：

- `*`：表示任意的一个单词
- `#`：表示0个或多个单词

![image-20220420233721239](https://cdn.jsdelivr.net/gh/letengzz/tc2/img202403122301740.jpg)
